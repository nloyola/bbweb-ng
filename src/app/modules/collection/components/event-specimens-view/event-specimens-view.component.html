<div class="card mt-2">
  <div class="card-header bg-primary text-light">
    <fa-icon [icon]="faVial"></fa-icon>
    <span class="ml-1" i18n>Specimens</span>
    <span class="float-right d-inline-block" ngbDropdown placement="bottom-right">
      <button class="btn btn-sm btn-light" type="button" id="eventSummaryMenu" ngbDropdownToggle>
        <mat-icon inline="true">more_vert</mat-icon>
      </button>

      <div class="dropdown-menu" ngbDropdownMenu aria-labelledby="eventSummaryMenu">
        <a class="dropdown-item" (click)="addSpecimen()">
          <mat-icon class="success-icon mr-1">add_circle</mat-icon>
          <ng-container i18n>Add Specimen</ng-container>
        </a>
      </div>
    </span>
  </div>

  <ul class="list-group list-group-flush">
    <table
      matSort
      (matSortChange)="sortData($event)"
      matSortActive="inventoryId"
      matSortDirection="asc"
      class="table table-striped table-condensed"
    >
      <tr>
        <th mat-sort-header="inventoryId">
          <small i18n><b>Inventory ID</b></small>
        </th>
        <th>
          <small><b i18n>Amount</b></small>
        </th>
        <th>
          <small><b i18n>Type</b></small>
        </th>
        <th mat-sort-header="timeCreated">
          <small i18n><b>Time created</b></small>
        </th>
        <th>
          <small><b i18n>Location</b></small>
        </th>
      </tr>

      <ng-container *ngIf="specimens$ | async as specimens">
        <ng-container *ngIf="specimensPageInfo$ | async as pageInfo">
          <tr *ngFor="let specimen of specimens">
            <td>
              <small>{{ specimen.inventoryId }}</small>
            </td>
            <td>
              <small>{{ specimen.amount }} {{ specimen.specimenDefinitionUnits }}</small>
            </td>
            <td>
              <small>{{ specimen.specimenDefinitionName }}</small>
            </td>
            <td>
              <small>{{ specimen.timeCreated | localTime }}</small>
            </td>
            <td>
              <small>{{ specimen.locationInfo.name }}</small>
            </td>
            <td>
              <span class="float-right d-inline-block" ngbDropdown placement="bottom-right">
                <button
                  class="btn btn-sm btn-outline-secondary"
                  type="button"
                  id="specimenMenu"
                  ngbDropdownToggle
                >
                  <mat-icon inline="true">more_vert</mat-icon>
                </button>

                <div class="dropdown-menu" ngbDropdownMenu role="menu" aria-labelledby="specimenMenu">
                  <a class="dropdown-item" (click)="viewSpecimen(specimen)">
                    <mat-icon class="success-icon mr-1">search</mat-icon>
                    <span i18n>View specimen</span>
                  </a>
                  <a class="dropdown-item" (click)="removeSpecimen(specimen)">
                    <mat-icon class="danger-icon mr-1">remove_circle</mat-icon>
                    <span i18n>Remove specimen</span>
                  </a>
                </div>
              </span>
            </td>
          </tr>
          <tr *ngIf="specimens.length > 0">
            <td colspan="6" style="text-align: center;">
              <ngb-pagination
                size="sm"
                [collectionSize]="pageInfo.total"
                [(page)]="currentPage"
                [maxSize]="speicmensLimit"
                [pageSize]="specimensLimit"
                [rotate]="false"
                [boundaryLinks]="true"
                aria-label="Default pagination"
                (pageChange)="paginationPageChanged($event)"
              >
              </ngb-pagination>
            </td>
          </tr>

          <tr *ngIf="specimens.length <= 0">
            <td colspan="6">
              <div class="alert alert-warning">
                <span i18n>No specimens collected yet.</span>
              </div>
            </td>
          </tr>
        </ng-container>
      </ng-container>

      <tr *ngIf="tableDataLoading">
        <td colspan="5" class="text-center" i18n>Loading ...</td>
      </tr>
    </table>
  </ul>
</div>

<ng-template #removeSpecimenModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      <mat-icon class="danger-icon mr-1">remove_circle</mat-icon>
      <span i18n>Remove Specimen</span>
    </h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body" i18n>
    <div class="alert alert-warning" role="alert">
      Are you sure you want to remove the specimen with inventory ID {{ this.specimenToRemove.inventoryId }}?
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()" i18n>Cancel</button>
    <button type="button" class="btn btn-primary" (click)="modal.close()" i18n>OK</button>
  </div>
</ng-template>
